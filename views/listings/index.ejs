<% layout('layouts/boilerplate') %>

<div class="listings-container">
    <!-- Filter Section -->
    <div class="filter-section">
        <div class="filter-container">
            <div class="filter-item <%= selectedCategory === 'all' ? 'active' : '' %>" data-category="all">
                <i class="fas fa-th-large"></i>
                <span>All</span>
            </div>
            <div class="filter-item <%= selectedCategory === 'apartment' ? 'active' : '' %>" data-category="apartment">
                <i class="fas fa-building"></i>
                <span>Apartments</span>
            </div>
            <div class="filter-item <%= selectedCategory === 'house' ? 'active' : '' %>" data-category="house">
                <i class="fas fa-home"></i>
                <span>Houses</span>
            </div>
            <div class="filter-item <%= selectedCategory === 'villa' ? 'active' : '' %>" data-category="villa">
                <i class="fas fa-warehouse"></i>
                <span>Villas</span>
            </div>
            <div class="filter-item <%= selectedCategory === 'cabin' ? 'active' : '' %>" data-category="cabin">
                <i class="fas fa-tree"></i>
                <span>Cabins</span>
            </div>
            <div class="filter-item <%= selectedCategory === 'hotel' ? 'active' : '' %>" data-category="hotel">
                <i class="fas fa-bed"></i>
                <span>Hotels</span>
            </div>
            <div class="filter-item <%= selectedCategory === 'resort' ? 'active' : '' %>" data-category="resort">
                <i class="fas fa-umbrella-beach"></i>
                <span>Resorts</span>
            </div>
            <div class="filter-item <%= selectedCategory === 'cottage' ? 'active' : '' %>" data-category="cottage">
                <i class="fas fa-campground"></i>
                <span>Cottages</span>
            </div>
            <div class="filter-item <%= selectedCategory === 'loft' ? 'active' : '' %>" data-category="loft">
                <i class="fas fa-city"></i>
                <span>Lofts</span>
            </div>
            <div class="filter-item <%= selectedCategory === 'studio' ? 'active' : '' %>" data-category="studio">
                <i class="fas fa-paint-brush"></i>
                <span>Studios</span>
            </div>
            <div class="filter-item <%= selectedCategory === 'penthouse' ? 'active' : '' %>" data-category="penthouse">
                <i class="fas fa-crown"></i>
                <span>Penthouses</span>
            </div>
        </div>
    </div>

    <!-- Search Results Header -->
    <% if (query && (query.location || query.category || query.priceRange)) { %>
        <div class="search-results-header">
            <div class="search-results-info">
                <h3>Search Results</h3>
                <div class="search-filters-applied">
                    <% if (query.location) { %>
                        <span class="search-filter-tag">
                            <i class="fas fa-map-marker-alt"></i>
                            <%= query.location %>
                        </span>
                    <% } %>
                    <% if (query.category) { %>
                        <span class="search-filter-tag">
                            <i class="fas fa-home"></i>
                            <%= query.category.charAt(0).toUpperCase() + query.category.slice(1) %>
                        </span>
                    <% } %>
                    <% if (query.priceRange) { %>
                        <span class="search-filter-tag">
                            <i class="fas fa-rupee-sign"></i>
                            <% if (query.priceRange === '50000+') { %>
                                ₹50,000+
                            <% } else { %>
                                ₹<%= query.priceRange.replace('-', ' - ₹') %>
                            <% } %>
                        </span>
                    <% } %>
                    <a href="/listings" class="clear-filters">
                        <i class="fas fa-times"></i>
                        Clear all
                    </a>
                </div>
                <p class="search-results-count">
                    <strong><%= listings.length %></strong> 
                    <%= listings.length === 1 ? 'property' : 'properties' %> found
                </p>
            </div>
        </div>
    <% } %>

    <!-- Listings Grid -->
    <div class="listings-grid">
        <% if (listings.length === 0) { %>
            <div class="no-listings">
                <i class="fas fa-search"></i>
                <h3>No listings found</h3>
                <p>Try selecting a different category or check back later.</p>
            </div>
        <% } else { %>
            <ul>
                <% listings.forEach(listing => { %>
                    <li>
                        <a href="/listings/<%= listing._id %>" class="listing-card-link">
                            <div class="listing-image-container">
                                <img src="<%= listing.image.url %>" alt="<%= listing.title %>" onerror="this.src='https://images.unsplash.com/photo-1552733407-5d5c46c3bb3b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTB8fHRyYXZlbHxlbnwwfHwwfHx8MA%3D%3D&auto=format&fit=crop&w=800&q=60'">
                                <div class="category-badge">
                                    <% if (listing.category === 'apartment') { %>
                                        <i class="fas fa-building"></i>
                                    <% } else if (listing.category === 'house') { %>
                                        <i class="fas fa-home"></i>
                                    <% } else if (listing.category === 'villa') { %>
                                        <i class="fas fa-warehouse"></i>
                                    <% } else if (listing.category === 'cabin') { %>
                                        <i class="fas fa-tree"></i>
                                    <% } else if (listing.category === 'hotel') { %>
                                        <i class="fas fa-bed"></i>
                                    <% } else if (listing.category === 'resort') { %>
                                        <i class="fas fa-umbrella-beach"></i>
                                    <% } else if (listing.category === 'cottage') { %>
                                        <i class="fas fa-campground"></i>
                                    <% } else if (listing.category === 'loft') { %>
                                        <i class="fas fa-city"></i>
                                    <% } else if (listing.category === 'studio') { %>
                                        <i class="fas fa-paint-brush"></i>
                                    <% } else if (listing.category === 'penthouse') { %>
                                        <i class="fas fa-crown"></i>
                                    <% } else { %>
                                        <i class="fas fa-building"></i>
                                    <% } %>
                                </div>
                            </div>
                            <div class="listing-content">
                                <h2><%= listing.title %></h2>
                                <p class="listing-description"><%= listing.description %></p>
                                <p class="listing-price">₹<%= listing.price.toLocaleString() %></p>
                                <p class="listing-location"><%= listing.location %>, <%= listing.country %></p>
                            </div>
                        </a>
                    </li>
                <% }) %>
            </ul>
        <% } %>
    </div>
</div>
          